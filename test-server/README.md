# 游戏测试服务器

本地测试服务器，用于测试自动下注脚本的功能。

## 功能特性

✅ **自动游戏循环** - 模拟真实游戏的开局、下注、封盘、开奖流程
✅ **下注接口模拟** - 完全兼容脚本的下注请求
✅ **实时消息推送** - 自动注入 console.log 消息
✅ **三种游戏模式**：
  - 自动随机：每期随机开庄/闲
  - 固定牌路：按预设牌路循环开奖
  - 手动控制：手动点击开奖

✅ **控制面板** - 实时控制游戏参数
✅ **下注记录** - 查看脚本的所有下注

## 快速开始

### 1. 安装依赖

```bash
cd test-server
npm install
```

### 2. 启动服务器

```bash
npm start
```

启动后会看到：
```
🚀 游戏测试服务器启动成功！
📍 访问地址: http://localhost:3000
🎮 游戏模式: auto
⏱️  周期时长: 30000ms
```

### 3. 打开浏览器测试

1. 访问 `http://localhost:3000`
2. 打开开发者工具（F12）
3. 点击书签栏的"运行脚本"
4. 观察脚本自动下注

## 使用说明

### 游戏模式

**自动随机**
- 每期随机开庄或闲
- 适合测试脚本的通用逻辑

**固定牌路**
- 按预设牌路循环开奖
- 可以自定义牌路，例如：`庄,庄,閒,庄,庄,閒`
- 适合测试特定牌路场景

**手动控制**
- 封盘后不自动开奖
- 需要手动点击"开庄"或"开闲"
- 适合精确控制测试流程

### 控制面板功能

**设置牌路**
- 输入格式：`庄,庄,閒,庄,庄,閒`
- 点击"设置牌路"生效
- 需要切换到"固定牌路"模式

**手动开奖**
- 仅在"手动控制"模式下有效
- 封盘后点击"开庄"或"开闲"

**周期时长**
- 设置每期游戏的时长（秒）
- 默认30秒，最小5秒
- 可以加快测试速度

### 下注记录

右侧面板实时显示：
- 期号
- 下注类型（庄/闲）
- 下注金额
- 下注时间

## 测试流程示例

### 测试场景1：随机开奖

```bash
1. 启动服务器（默认自动随机模式）
2. 打开浏览器，运行脚本
3. 脚本会根据牌路自动下注
4. 观察控制台日志和盈亏计算
```

### 测试场景2：固定牌路

```bash
1. 在控制面板选择"固定牌路"
2. 设置牌路：庄,庄,閒,庄,庄,閒
3. 运行脚本
4. 观察脚本是否正确识别并激活牌路
```

### 测试场景3：手动精确控制

```bash
1. 选择"手动控制"模式
2. 手动输入几个开奖结果，激活牌路
3. 观察脚本的激活状态
4. 继续手动开奖，测试推进逻辑
```

## API 接口

### POST /doXiazhu.html
下注接口

**请求：**
```
Content-Type: application/x-www-form-urlencoded
Body: message=庄100
```

**响应：**
```json
{
  "code": 0,
  "msg": [],
  "message": "操作成功"
}
```

### GET /api/messages
获取待推送的消息

### GET /api/status
获取游戏状态

### POST /api/control
控制游戏（设置模式、牌路等）

## 注意事项

1. **端口占用**：确保3000端口未被占用
2. **模式切换**：修改后立即生效
3. **周期时长**：修改后下一期生效
4. **手动模式**：需要手动点击开奖按钮

## 开发调试

使用 nodemon 自动重启：

```bash
npm run dev
```

## 故障排除

**问题：脚本没有自动下注**
- 检查是否在下注时间窗口内
- 查看控制台是否收到"开局"消息
- 确认牌路是否已激活

**问题：下注失败**
- 检查游戏状态（是否已封盘）
- 查看服务器端日志

**问题：消息没有注入到控制台**
- 刷新页面重新连接
- 检查浏览器控制台是否有错误
